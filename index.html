<!DOCTYPE html>
<html>
  <head>
    <title>Peabody's Performance Calculator</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=700, user-scalable=1">
    <style>
        body {
            background-color: rgb(21, 28, 30);
            color:rgb(205, 212, 218);
        }
        input {
            background-color: rgb(28, 37, 40);
            color:rgb(205, 212, 218);
            border: rgb(200, 200, 200) solid 1px;
        }
        input:disabled {
            background-color: rgb(47, 58, 62);
            color:rgb(175, 182, 188);
        }
        select {
            background-color: rgb(28, 37, 40);
            color:rgb(205, 212, 218);
        }
        button {
            background-color: rgb(28, 37, 40);
            color:rgb(205, 212, 218);
        }
        button:hover:enabled {
            background-color: rgb(140, 189, 220);
            color:rgb(69, 71, 72);
        }
        .subscript {
            font-size:20px;
        }
        .numberLabel {
            font-size:24px;
        }
        
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript">
        
        const aircraft_weight = {
            ME: 0,
            N103UV: 1767.89,
            N104UV: 1735.86,
            N105UV: 1754.86,
            N106UV: 1771.86,
            N107UV: 1844.80,
            N108UV: 1777.00,
            N109UV: 1813.33,
            N110UV: 1815.90,
            N112UV: 1815.24,
            N113UV: 1815.64,
            N114UV: 1810.04,
            N115UV: 1808.94,
            N116UV: 1808.76,
            N118UV: 1817.35,
            N119UV: 1813.42,
            N749DS: 1799.10,
            N779US: 1789.94,
            N793US: 1800.84,
            N4012X: 1794.56
        };
        const aircraft_cg = {
            ME: 0,
            N103UV: 96.598,
            N104UV: 96.99,
            N105UV: 96.85,
            N106UV: 97.07,
            N107UV: 98.4,
            N108UV: 96.58,
            N109UV: 97.6,
            N110UV: 97.45,
            N112UV: 97.25,
            N113UV: 97.52,
            N114UV: 97.32,
            N115UV: 97.36,
            N116UV: 97.16,
            N118UV: 97.46,
            N119UV: 97.65,
            N749DS: 98.13,
            N779US: 98.33,
            N793US: 98.01,
            N4012X: 99.22
        };
        const aircraft_max_landing_weight = {
            ME: 2535,
            N103UV: 2407,
            N104UV: 2407,
            N105UV: 2407,
            N106UV: 2407,
            N107UV: 2535,
            N108UV: 2535,
            N109UV: 2535,
            N110UV: 2535,
            N112UV: 2535,
            N113UV: 2535,
            N114UV: 2535,
            N115UV: 2535,
            N116UV: 2535,
            N118UV: 2535,
            N119UV: 2535,
            N749DS: 2535,
            N779US: 2407,
            N793US: 2535,
            N4012X: 2535
        };
        const aircraft_max_takeoff_weight = 2646;
        const aircraft_utility_category_max_weight = 2161;
        const aircraft_long_range_tank = {
            ME: true,
            N103UV: true,
            N104UV: true,
            N105UV: true,
            N106UV: true,
            N107UV: true,
            N108UV: true,
            N109UV: false,
            N110UV: false,
            N112UV: false,
            N113UV: false,
            N114UV: false,
            N115UV: false,
            N116UV: false,
            N118UV: false,
            N119UV: false,
            N749DS: true,
            N779US: true,
            N793US: true,
            N4012X: true
        };
        //classifies the baggage configuration - See AFM 6-6.
        const aircraft_baggage_configuration = {
            ME: "b",
            N103UV: "a",
            N104UV: "a",
            N105UV: "c",
            N106UV: "a",
            N107UV: "c",
            N108UV: "c",
            N109UV: "c",
            N110UV: "c",
            N112UV: "c",
            N113UV: "c",
            N114UV: "c",
            N115UV: "c",
            N116UV: "c",
            N118UV: "c",
            N119UV: "c",
            N749DS: "c",
            N779US: "c",
            N793US: "c",
            N4012X: "c"
        };
        const station_arm = {
            oil: 39.4,
            front_seats: 90.6,
            rear_seats: 128.0,
            wing_tanks: 103.5,
            standard_baggage_compartment: 143.7,
            standard_baggage_tube: 170.1,
            extended_baggage_forward: 153.1,
            extended_baggage_aft: 178.7,
        };
        const station_max_value = {//this is the allowable value upper limits for a given station
            standard_baggage_compartment: 66,
            standard_baggage_tube: 11,
            extended_baggage_forward: 100,
            extended_baggage_aft: 40,
            extended_baggage_total: 100
        };
        const fuel_max_value = {//ture if long range tank
            true: 50,
            false: 40.2
        };
        const aft_max_cg_value = {//true if long range tank
            true: 100.4,
            false: 102.0
        };

        const takeoff_atmospheric_data = {//consists of many data points for the first section of the takeoff calculation graph. Linear interpolation is used to find more precice values from this data.
            altitude: [0, 2000, 4000, 6000, 8000, 10000],
            temp: [-20, -10, 0, 10, 20, 30, 40, 50],
            data: [ //altitude is the first index, temperature is the second
                [1.089387, 1.2830558, 1.5977676, 1.8640622, 2.2756084, 2.6387374, 2.9776578, 3.4134126],
                [1.6461848, 1.9124794, 2.2756084, 2.5903202, 3.026075, 3.4618298, 3.9702104, 4.5270082],
                [2.3724428, 2.6871546, 3.0987008, 3.510247, 4.1396706, 4.7448856, 5.325892, 5.9795242],
                [3.0987008, 3.5828728, 4.1396706, 4.84172, 5.5921866, 6.3910704, 7.3594144, 8.5698444],
                [4.0912534, 4.9385544, 5.7858554, 6.7299908, 7.8435864, 9.1750594, 11.2085818, 13.9683622],
                [5.8342726, 6.778408, 7.8435864, 9.1750594, 11.1843732, 13.7262762]
            ]
        }

        const fuel_mass = 6.01;//lbs per gallon of fuel
        const oil_mass = 1.86; //lbs per qt of oil
        const taxi_fuel_burn = 0.5;//in gallons

        const takeoff_color = "#40B240";
        const landing_color = "#EDE23D";
        const zero_color = "#549DC8";

        function load() {//called on load of the body
            changeAircraft("ME");//'ME' stands for manual entry, which is the default selection.
        }
        function changeAircraft(new_aircraft) {
            //reference for input elements
            let empty_weight_element = document.getElementById("empty_weight");
            let empty_cg_element = document.getElementById("empty_cg");
            let bag_weight_2_element = document.getElementById("bag_area_2");

            //reference for max value tag elements
            let max_bag_1_element = document.getElementById("max_bag_1");
            let max_bag_2_element = document.getElementById("max_bag_2");
            let max_gal_element = document.getElementById("max_gal");

            let using_preset = !(new_aircraft == "ME");//true when the user doesn't have [Manual Entry] selected
            empty_weight_element.disabled = using_preset;
            empty_cg_element.disabled = using_preset;

            //retrieve weights from the preset constant values
            empty_weight_element.value = aircraft_weight[new_aircraft];
            empty_cg_element.value = aircraft_cg[new_aircraft];

            //display bag limits
            bag_weight_2_element.disabled = false;
            if (aircraft_baggage_configuration[new_aircraft] == "c") {
                max_bag_1_element.innerHTML = "lb (max " + station_max_value["extended_baggage_forward"] + "lb)";
                max_bag_2_element.innerHTML = "lb (max " + station_max_value["extended_baggage_aft"] + "lb)";
            } else {
                max_bag_1_element.innerHTML = "lb (max " + station_max_value["standard_baggage_compartment"] + "lb)";
                if (aircraft_baggage_configuration[new_aircraft] == "b") {
                    max_bag_2_element.innerHTML = "lb (max " + station_max_value["standard_baggage_tube"] + "lb)";
                } else {
                    max_bag_2_element.innerHTML = "lb";
                    bag_weight_2_element.disabled = true;
                    bag_weight_2_element.value = "";
                }
            }

            //display fuel limits
            max_gal_element.innerHTML = "gal (max " + fuel_max_value[aircraft_long_range_tank[new_aircraft]] + ")";

        }
        function getAirport() {
            //case insensitive (prefer lowercase)
            //let metarReq = "https://aviationweather.gov/api/data/metar?ids=kpvu";
            //uppercase!
            //let airportInfo = "https://aviationweather.gov/api/data/airport?ids=KPVU";
            
            //HTTP request
            //console.log(jQuery.get(metarReq));
            
            alert("not working yet");
        }
        function calculatePerformance() {

            //data collection variables
            let performance_input_page = document.getElementById("performance_input_page");
            let results_page = document.getElementById("results_page");
            let header = document.getElementById("header");

            let aircraft = document.getElementById("aircraft").value;
            let empty_weight = Number(document.getElementById("empty_weight").value);
            let empty_cg = Number(document.getElementById("empty_cg").value);

            let front_weight = Number(document.getElementById("front_weight").value);
            let front_weight_2 = Number(document.getElementById("front_weight_2").value);
            let rear_weight = Number(document.getElementById("rear_weight").value);
            let rear_weight_2 = Number(document.getElementById("rear_weight_2").value);
            
            let bag_weight = Number(document.getElementById("bag_area_1").value);
            let bag_weight_2 = Number(document.getElementById("bag_area_2").value);

            let fuel = Number(document.getElementById("fuel").value);
            let fuel_use = Number(document.getElementById("fuel_use").value);

            let field_elevation = Number(document.getElementById("field_elevation").value);
            let field_temperature = Number(document.getElementById("field_temperature").value);
            let altimiter_setting = Number(document.getElementById("altimiter_setting").value);

            let disclaimer = document.getElementById("disclaimer");
            
            //display variables
            let toWeight = document.getElementById("toWeight")
            let ldgWeight = document.getElementById("ldgWeight")
            let ZFWeight = document.getElementById("ZFWeight")

            //verify info is valid
            //mostly negative checks here:
            if (empty_weight <= 0) {
                alert("Weight is not a valid value. Must be positive.");
                return;
            }
            if (empty_cg <= 0) {
                alert("Arm is not a valid value. Must be positive.");
                return;
            }
            if ((front_weight < 0) || (front_weight_2 < 0)) {
                alert("Front Seats are not a valid value. Must be positive.");
                return;
            }
            if ((rear_weight < 0) || (rear_weight_2 < 0)) {
                alert("Rear Seats are not a valid value. Must be positive.");
                return;
            }
            if ((bag_weight < 0) || (bag_weight_2 < 0)) {
                alert("Baggage is not a valid value. Must be positive.");
                return;
            }
            if (altimiter_setting.value <= 0) {
                alert("Altimiter setting is not a valid value. Must be positive.");
                return;
            }
            if (!disclaimer.checked) {
                alert("Please check the disclaimer box to continue.");
                return;
            }
            //check bag and fuel max
            let max_bag_weight_1 = 0;
            let max_bag_weight_2 = 0;
            if (aircraft_baggage_configuration[aircraft] == "c") {
                max_bag_weight_1 = station_max_value["extended_baggage_forward"];
                max_bag_weight_2 = station_max_value["extended_baggage_aft"];
                if (bag_weight + bag_weight_2 > station_max_value["extended_baggage_total"]) {
                    alert("Baggage exceeds maximum station weight. Forward and aft cannot be greater than 100lb combined. AFM 2-11");
                    return;
                }
            } else {
                max_bag_weight_1 = station_max_value["standard_baggage_compartment"];
                max_bag_weight_2 = station_max_value["standard_baggage_tube"];
            }
            if ((bag_weight > max_bag_weight_1) || (bag_weight_2 > max_bag_weight_2)) {
                alert("Baggage exceeds maximum station weight. AFM 2-11");
                return;
            }
            if (fuel > fuel_max_value[aircraft_long_range_tank[aircraft]]) {
                alert("Fuel quantity exceeds limits.");
                return;
            }
            if (fuel_use > fuel) {
                alert("Fuel use is greater than fuel available.");
                return;
            }
            if (field_elevation < -1000 || field_elevation > 12000) {
                alert("Field Elevation must be within the bounds [-1000, 12000]");
                return;
            }
            if (field_temperature < -40 || field_temperature > 50) {
                alert("Temperature must be within the bounds [-40, 50]");
                return;
            }

            //compute weight and balance
            let total_ZF_weight = empty_weight + front_weight + front_weight_2 + rear_weight + rear_weight_2 + bag_weight + bag_weight_2 - (2*oil_mass);
            let total_ramp_weight =  total_ZF_weight + (fuel*fuel_mass);
            let total_takeoff_weight = total_ramp_weight - (taxi_fuel_burn * fuel_mass);
            let total_landing_weight = total_ramp_weight - (fuel_use*fuel_mass);

            let ZF_moment = (empty_weight * empty_cg) + ((front_weight+front_weight_2) * station_arm["front_seats"]) + ((rear_weight+rear_weight_2) * station_arm["rear_seats"]) - (2*oil_mass*station_arm["oil"]);

            if (aircraft_baggage_configuration[aircraft] == "c") {
                ZF_moment += (bag_weight * station_arm["extended_baggage_forward"]) + (bag_weight_2 * station_arm["extended_baggage_aft"]);
            } else {
                ZF_moment += (bag_weight * station_arm["standard_baggage_compartment"]) + (bag_weight_2 * station_arm["standard_baggage_tube"]);
            }

            let ramp_moment = ZF_moment + (fuel * fuel_mass * station_arm["wing_tanks"]);
            let takeoff_moment = ramp_moment - (taxi_fuel_burn * fuel_mass * station_arm["wing_tanks"]);
            let landing_moment = ramp_moment - (fuel_use * fuel_mass * station_arm["wing_tanks"]);

            let ZF_cg = ZF_moment / total_ZF_weight;
            let ramp_cg = ramp_moment / total_ramp_weight;
            let takeoff_cg = takeoff_moment / total_takeoff_weight;
            let landing_cg = landing_moment / total_landing_weight;

            //compute performance
            let pressure_altitude = field_elevation + ((altimiter_setting - 29.92) * -930);
            pressure_altitude = field_elevation;
            //takeoff
            //let takeoff_atmospheric_parameter = (0.183908 * Math.exp(0.000303751 * pressure_altitude) + 3.34675) * Math.exp((0.00695801 * Math.exp(0.0000987383 * pressure_altitude) + 0.00108574) * field_temperature) + (0.00028 * pressure_altitude) - 2;
            
            //console.log("atmospheric parameter: " + takeoff_atmospheric_parameter);

            //this finds the two closest pressure altitude and temperature values in the available dataset to linearly interpolate from
            let pressure_index_1 = 0;
            let pressure_index_2 = takeoff_atmospheric_data["altitude"].length - 1;
            //find lower bound for pressure
            for (let i = 0; i < takeoff_atmospheric_data["altitude"].length - 1; i++) {
                if (pressure_altitude >= takeoff_atmospheric_data["altitude"][i]) {
                    pressure_index_1 = i;
                }
            }
            //find upper bound for pressure
            for (let i = takeoff_atmospheric_data["altitude"].length - 1; i > 0; i--) {
                if (pressure_altitude < takeoff_atmospheric_data["altitude"][i]) {
                    pressure_index_2 = i;
                }
            }
            let temp_index_1 = 0;
            let temp_index_2 = takeoff_atmospheric_data["temp"].length - 1;
            //find lower bound for pressure
            for (let i = 0; i < takeoff_atmospheric_data["temp"].length - 1; i++) {
                if (field_temperature >= takeoff_atmospheric_data["temp"][i]) {
                    temp_index_1 = i;
                }
            }
            //find upper bound for pressure
            for (let i = takeoff_atmospheric_data["temp"].length - 1; i > 0; i--) {
                if (field_temperature < takeoff_atmospheric_data["temp"][i]) {
                    temp_index_2 = i;
                }
            }
            //linearly interpolate to find takeoff parameter for both the higher and lower altitude lines.
            let lower_atmospheric_parameter = linear_interpolate(takeoff_atmospheric_data["temp"][temp_index_1], takeoff_atmospheric_data["temp"][temp_index_2], takeoff_atmospheric_data["data"][pressure_index_1][temp_index_1], takeoff_atmospheric_data["data"][pressure_index_1][temp_index_2], field_temperature);
            let upper_atmospheric_parameter = 0;
            if (field_temperature >= 30 && pressure_altitude >= 8000) { //this is an edge case since we don't have data beyond 30C for the 10000 line
                upper_atmospheric_parameter = linear_interpolate(takeoff_atmospheric_data["temp"][4], takeoff_atmospheric_data["temp"][5], takeoff_atmospheric_data["data"][pressure_index_2][4], takeoff_atmospheric_data["data"][pressure_index_2][5], field_temperature);
            } else {//this will run most of the time for sure!
                upper_atmospheric_parameter = linear_interpolate(takeoff_atmospheric_data["temp"][temp_index_1], takeoff_atmospheric_data["temp"][temp_index_2], takeoff_atmospheric_data["data"][pressure_index_2][temp_index_1], takeoff_atmospheric_data["data"][pressure_index_2][temp_index_2], field_temperature);
            }
            //now interpolate between 2 pressure altitude lines to find the parameter
            let takeoff_atmospheric_parameter = linear_interpolate(takeoff_atmospheric_data["altitude"][pressure_index_1], takeoff_atmospheric_data["altitude"][pressure_index_2], lower_atmospheric_parameter, upper_atmospheric_parameter, pressure_altitude);
            
            if (takeoff_atmospheric_parameter > 13) {//check that a safe takeoff can be made
                alert("Density altitude is too high for a predictable takeoff under any weight.");
                return;
            }

            //display results
            //header
            let date = new Date();
            header.innerHTML = "<button onclick='back()'>←Go Back</button>&nbsp;Generated " + (date.getMonth()+1) + "/" + date.getDate() + "/" + date.getFullYear() + " " + date.getUTCHours() + ":" + date.getUTCMinutes() + "Z [You may screenshot this page]";
            
            //weight and balance chart
            draw_weight_and_balance_setting();
            draw_envelope(aircraft);
            draw_aircraft(total_ramp_weight, ramp_cg, total_landing_weight, landing_cg, total_ZF_weight, ZF_cg, aircraft);
            
            //weight and balance numbers
            toWeight.innerHTML = Math.round(total_takeoff_weight);
            ldgWeight.innerHTML = Math.round(total_landing_weight);
            ZFWeight.innerHTML = Math.round(total_ZF_weight);

            toWeight.style.color = takeoff_color;
            ldgWeight.style.color = landing_color;
            ZFWeight.style.color = zero_color;
            
            //show the div!
            performance_input_page.style.display = "none";
            results_page.style.display = "block";

            

        }
        function back() {
            performance_input_page.style.display = "block";
            results_page.style.display = "none";
        }
        function linear_interpolate(x1, x2, y1, y2, x) {
            return (((y2-y1)/(x2-x1)) * (x - x1)) + y1;
        }
        function tx(x) {//convert x value in in to px of the canvas
            return (x-93)*32 + 60;
        }
        function ty(y) {//convert x value in lb to px of the canvas
            return 260 - ((y-1600)*0.183);
        }
        function draw_aircraft(to_weight, to_cg, ldg_weight, ldg_cg, zero_weight, zero_cg, aircraft) {
            let c = document.getElementById("W&B");
            let ctx = c.getContext("2d");
            ctx.lineWidth = 1;
            ctx.strokeStyle = "#ffffff";
            ctx.setLineDash([]);
            

            
            //line connecting cgs for fuel
            ctx.beginPath();
            ctx.moveTo(tx(to_cg),ty(to_weight));
            ctx.lineTo(tx(ldg_cg),ty(ldg_weight));
            ctx.lineTo(tx(zero_cg),ty(zero_weight));
            ctx.stroke();

            ctx.lineWidth = 4;
            //takeoff
            ctx.strokeStyle = "#40B240";
            ctx.beginPath();
            ctx.arc(tx(to_cg),ty(to_weight), 2, 0, 2 * Math.PI);
            ctx.stroke();

            //landing
            ctx.strokeStyle = "#EDE23D";
            ctx.beginPath();
            ctx.arc(tx(ldg_cg),ty(ldg_weight), 2, 0, 2 * Math.PI);
            ctx.stroke();

            //zero fuel
            ctx.strokeStyle = "#549DC8";
            ctx.beginPath();
            ctx.arc(tx(zero_cg),ty(zero_weight), 2, 0, 2 * Math.PI);
            ctx.stroke();
        }
        function draw_envelope(aircraft) {//draws the envelope on the graph based on whether it's a long range tank or not.
            let c = document.getElementById("W&B");
            let ctx = c.getContext("2d");
            ctx.lineWidth = 1;
            ctx.setLineDash([10, 15]);
            ctx.font = "12px Arial";
            ctx.fillStyle = "#FF9EFF";
            ctx.strokeStyle = "#FF9EFF";

            let aft_max_cg = aft_max_cg_value[aircraft_long_range_tank[aircraft]];
            let xpos = 286;
            if (aircraft_long_range_tank[aircraft]) {
                xpos = 305;
            }

            //utility max line
            ctx.beginPath();
            ctx.moveTo(tx(93),ty(aircraft_utility_category_max_weight));
            ctx.lineTo(tx(103),ty(aircraft_utility_category_max_weight));
            ctx.stroke();
            ctx.fillText("Utility Max", xpos, ty(aircraft_utility_category_max_weight)+14);

            //landing max line
            ctx.fillStyle = "#73C3DA";
            ctx.strokeStyle = "#73C3DA";
            ctx.beginPath();
            ctx.moveTo(tx(93),ty(aircraft_max_landing_weight[aircraft]));
            ctx.lineTo(tx(103),ty(aircraft_max_landing_weight[aircraft]));
            ctx.stroke();
            ctx.fillText("Landing Max", 70, ty(aircraft_max_landing_weight[aircraft])+14);

            //takeoff max line
            ctx.fillStyle = "#FFFFFF";
            ctx.strokeStyle = "#FFFFFF";
            ctx.beginPath();
            ctx.moveTo(tx(93),ty(aircraft_max_takeoff_weight));
            ctx.lineTo(tx(103),ty(aircraft_max_takeoff_weight));
            ctx.stroke();
            ctx.fillText("Takeoff Max", 70, ty(aircraft_max_takeoff_weight)+14);

            //envelope
            ctx.setLineDash([]);
            ctx.lineWidth = 2;
            ctx.strokeStyle = "#FFFFFF";
            ctx.beginPath();
            ctx.moveTo(tx(94.5),ty(1720));
            ctx.lineTo(tx(94.5),ty(2161));
            ctx.lineTo(tx(97.6),ty(2646));
            ctx.lineTo(tx(aft_max_cg),ty(2646));
            ctx.lineTo(tx(aft_max_cg),ty(1720));
            ctx.lineTo(tx(94.5),ty(1720));
            ctx.stroke();
        }
        function draw_weight_and_balance_setting() {//400x300 canvas cg 93-103 (10range over 320px = 32px/in). weight 1600-2800 (1200 range over 220px = 0.183px per lb)
            let c = document.getElementById("W&B");
            let ctx = c.getContext("2d");
            ctx.strokeStyle = "#ffffff";
            ctx.fillStyle = "#ffffff";
            ctx.lineWidth = 1;
            ctx.font = "15px Arial";
            ctx.setLineDash([]);

            ctx.clearRect(0,0,400,300);

            ctx.beginPath();
            ctx.moveTo(tx(103),ty(1600));
            ctx.lineTo(tx(93),ty(1600));
            ctx.lineTo(tx(93),ty(2800));
            

            //horizontal axis
            ctx.fillText("GC pos. (in)", 150, 295);
            for (let i = 94; i< 103; i+=2) {
                //ctx.moveTo(tx(i),ty(lb));
                //ctx.lineTo(tx(i),ty(ub));
                ctx.fillText(i, tx(i)-10, ty(1600)+18);
            }

            //vertical axis
            ctx.fillText("Weight (lb)", 5, 20);
            for (let i = 8; i<= 14; i++) {
                //ctx.moveTo(tx(lb),ty(i*200));
                //ctx.lineTo(tx(ub),ty(i*200));
                ctx.fillText(i*200, tx(93)-40, ty(i*200)+5);
            }

            ctx.stroke();

            ctx.beginPath();
            ctx.strokeStyle = "#555555";
            
            let ub = 2800;
            let lb = 1600;
            for (let i = 94; i<= 103; i++) {
                ctx.moveTo(tx(i),ty(lb));
                ctx.lineTo(tx(i),ty(ub));
            }
            

            ub = 103;
            lb = 93;
            for (let i = 9; i<= 14; i++) {
                ctx.moveTo(tx(lb),ty(i*200));
                ctx.lineTo(tx(ub),ty(i*200));
            }
            ctx.stroke();
            
        }
        
    </script>
  </head>

<body onload="load();">
    <div id="performance_input_page" style="display:block;width:600px;margin:auto;">
        <div style="display: flex;justify-content: center;">
            <img src="images/logo.png" alt="PPC Logo" style="max-width: 200px;">
        </div>
        <p>(V0.3) This tool is used for calculating weight&balance and performance for the DA40. Primarily for use with UVU aircraft. Calculations may not perfectly represent the values derived through use of an approved AFM. For simplicity, oil is assumed to be 6qts.</p>
        <h3>Enter performance parameters (DA40)</h3>

        <h4>-Select Aircraft-</h4>
        <table>
            <tr>
                <td><label for="aircraft">Identifier:</label></td>
                <td>
                    <select id="aircraft" onchange="changeAircraft(this.value);">
                        <option value="ME">[Manual Entry]</option>
                        <option value="N103UV">N103UV</option>
                        <option value="N104UV">N104UV</option>
                        <option value="N105UV">N105UV</option>
                        <option value="N106UV">N106UV</option>
                        <option value="N107UV">N107UV</option>
                        <option value="N108UV">N108UV</option>
                        <option value="N109UV">N109UV</option>
                        <option value="N110UV">N110UV</option>
                        <option value="N112UV">N112UV</option>
                        <option value="N113UV">N113UV</option>
                        <option value="N114UV">N114UV</option>
                        <option value="N115UV">N115UV</option>
                        <option value="N116UV">N116UV</option>
                        <option value="N118UV">N118UV</option>
                        <option value="N119UV">N119UV</option>
                        <option value="N749DS">N749DS</option>
                        <option value="N779US">N779US</option>
                        <option value="N793US">N793US</option>
                        <option value="N4012X">N4012X</option>
                    </select>
                </td>
                <td></td>
            </tr>
            <tr>
                <td><label for="empty_weight">Empty Weight:</label></td>
                <td><input type="number" id="empty_weight"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td><label for="empty_cg">Empty Arm:</label></td>
                <td><input type="number" id="empty_cg"></td>
                <td>in</td>
            </tr>
        </table><br>

        <h4>-Aircraft Loading-</h4>
        <table>
            <tr>
                <td><label for="front_weight">Front Seats:</label></td>
                <td><input type="number" id="front_weight" name="front_weight"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td></td>
                <td><input type="number" id="front_weight_2" name="front_weight_2"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td><label for="rear_weight">Rear Seats:</label></td>
                <td><input type="number" id="rear_weight" name="rear_weight"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td></td>
                <td><input type="number" id="rear_weight_2" name="rear_weight_2"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td><label for="bag_area_1">Forward Baggage:</label></td>
                <td><input type="number" id="bag_area_1" name="bag_area_1"></td>
                <td id="max_bag_1">lb</td>
            </tr>
            <tr>
                <td><label for="bag_area_2">Aft Baggage:</label></td>
                <td><input type="number" id="bag_area_2" name="bag_area_2"></td>
                <td id="max_bag_2">lb</td>
            </tr>
            <tr>
                <td><label for="fuel">Starting Fuel:</label></td>
                <td><input type="number" id="fuel" name="fuel"></td>
                <td id="max_gal">gal</td>
            </tr>
            <tr>
                <td><label for="fuel_use">Fuel Use:</label></td>
                <td><input type="number" id="fuel_use" name="fuel_use"></td>
                <td>gal</td>
            </tr>
        </table><br>

        <h4>-Airport Conditions-</h4>
        <table>
            <tr>
                <td><label for="airport">Airport Identifier:</label></td>
                <td><input type="text" id="airport" name="airport" value="kpvu (this isn't working yet)" disabled="true"></td>
                <td><button onclick="getAirport()" disabled="true">Auto collect weather</button></td>

            </tr>
            <tr>
                <td><label for="field_elevation">Field Elevation:</label></td>
                <td><input type="number" id="field_elevation" name="field_elevation" value="4500"></td>
                <td>ft</td>
            </tr>
            <tr>
                <td><label for="field_temperature">Temperature:</label></td>
                <td><input type="number" id="field_temperature" name="field_temperature" value="15"></td>
                <td>°c</td>
            </tr>
            <tr>
                <td><label for="altimiter_setting">Altimiter Setting:</label></td>
                <td><input type="number" id="altimiter_setting" name="altimiter_setting" value="29.92"></td>
                <td>in Hg</td>
            </tr>
        </table><br>
        <label for="disclaimer">Disclaimer: By checking this box, you understand that this tool does not replace the pilot's responsibility to verify performance charactaristics with the aircraft's approved AFM.</label><br>
        <input id="disclaimer" type="checkbox"><br><br>
        <button onclick="calculatePerformance()">Calculate Performance</button>
    </div>
    <div id="results_page"  style="display:none;width:600px;margin:auto;">
        <div id="header" style="width: 600px;"></div><br>
            <table style="width:200px;font-size:32px;float:right;">
                <tr>
                    <td style="color:aquamarine;">V<sub class="subscript">GLIDE</sub></td>
                    <td id="Vg" style="color:aquamarine;"><u>00</u></td>
                </tr>
                <tr>
                    <td>V<sub class="subscript">R</sub></td>
                    <td>59</td>
                </tr>
                <tr>
                    <td>V<sub class="subscript">Y</sub></td>
                    <td id="Vy">00</td>
                </tr>
                <tr>
                    <td>V<sub class="subscript">Cruise Climb</sub></td>
                    <td id="Vcruise_climb">00</td>
                </tr>
                <tr>
                    <td>V<sub class="subscript">A</sub></td>
                    <td id="Va">100</td>
                </tr>
                <tr>
                    <td>V<sub class="subscript">REF</sub></td>
                    <td id="Vref">00</td>
                </tr>
            </table>
            <div style="width:400px;font-size:32px;float: left; text-align: right;">
                <table>
                    <tr>
                        <td class="numberLabel">Takeoff Distance:</td>
                        <td id="toDist">0000</td>
                        <td class="numberLabel">&nbsp;/50':</td>
                        <td id="toDist">0000</td>
                    </tr>
                    <tr>
                        <td class="numberLabel">Landing Distance:</td>
                        <td id="toDist">0000</td>
                        <td class="numberLabel">&nbsp;/50':</td>
                        <td id="toDist">0000</td>
                    </tr>
                </table><br>
                <table>
                    <tr>
                        <td class="numberLabel">Takeoff Weight:</td>
                        <td id="toWeight">0000</td>
                    </tr>
                    <tr>
                        <td class="numberLabel">Landing Weight:</td>
                        <td id="ldgWeight">0000</td>
                    </tr>
                    <tr>
                        <td class="numberLabel">Zero Fuel Weight:</td>
                        <td id="ZFWeight">0000</td>
                    </tr>
                </table>
            </div>
        <canvas id="W&B" width="400" height="300" style="background-color:rgb(21, 28, 30)"></canvas>
    </div>
</body>
</html>
