<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background-color: rgb(21, 28, 30);
            color:rgb(205, 212, 218);
        }
        input {
            background-color: rgb(28, 37, 40);
            color:rgb(205, 212, 218);
            border: rgb(200, 200, 200) solid 1px;
        }
        input:disabled {
            background-color: rgb(47, 58, 62);
            color:rgb(175, 182, 188);
        }
        select {
            background-color: rgb(28, 37, 40);
            color:rgb(205, 212, 218);
        }
        button {
            background-color: rgb(28, 37, 40);
            color:rgb(205, 212, 218);
        }
        button:hover:enabled {
            background-color: rgb(140, 189, 220);
            color:rgb(69, 71, 72);
        }
        
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript">
        
        const aircraft_weight = {
            ME: 0,
            N103UV: 1767.89,
            N104UV: 1735.86,
            N105UV: 1754.86,
            N106UV: 1771.86,
            N107UV: 1844.80,
            N108UV: 1777.00,
            N109UV: 1813.33,
            N110UV: 1815.90,
            N112UV: 1815.24,
            N113UV: 1815.64,
            N114UV: 1810.04,
            N115UV: 1808.94,
            N116UV: 1808.76,
            N118UV: 1817.35,
            N119UV: 1813.42,
            N749DS: 1799.10,
            N779US: 1789.94,
            N793US: 1800.84,
            N4012X: 1794.56
        };
        const aircraft_cg = {
            ME: 0,
            N103UV: 96.598,
            N104UV: 96.99,
            N105UV: 96.85,
            N106UV: 97.07,
            N107UV: 98.4,
            N108UV: 96.58,
            N109UV: 97.6,
            N110UV: 97.45,
            N112UV: 97.25,
            N113UV: 97.52,
            N114UV: 97.32,
            N115UV: 97.36,
            N116UV: 97.16,
            N118UV: 97.46,
            N119UV: 97.65,
            N749DS: 98.13,
            N779US: 98.33,
            N793US: 98.01,
            N4012X: 99.22
        };
        const aircraft_max_landing_weight = {
            ME: 2535,
            N103UV: 2407,
            N104UV: 2407,
            N105UV: 2407,
            N106UV: 2407,
            N107UV: 2535,
            N108UV: 2535,
            N109UV: 2535,
            N110UV: 2535,
            N112UV: 2535,
            N113UV: 2535,
            N114UV: 2535,
            N115UV: 2535,
            N116UV: 2535,
            N118UV: 2535,
            N119UV: 2535,
            N749DS: 2535,
            N779US: 2407,
            N793US: 2535,
            N4012X: 2535
        };
        const aircraft_max_takeoff_weight = 2646;
        const aircraft_long_range_tank = {
            ME: true,
            N103UV: true,
            N104UV: true,
            N105UV: true,
            N106UV: true,
            N107UV: true,
            N108UV: true,
            N109UV: false,
            N110UV: false,
            N112UV: false,
            N113UV: false,
            N114UV: false,
            N115UV: false,
            N116UV: false,
            N118UV: false,
            N119UV: false,
            N749DS: true,
            N779US: true,
            N793US: true,
            N4012X: true
        };
        //classifies the baggage configuration - See AFM 6-6.
        const aircraft_baggage_configuration = {
            ME: "a",
            N103UV: "a",
            N104UV: "a",
            N105UV: "c",
            N106UV: "a",
            N107UV: "c",
            N108UV: "c",
            N109UV: "c",
            N110UV: "c",
            N112UV: "c",
            N113UV: "c",
            N114UV: "c",
            N115UV: "c",
            N116UV: "c",
            N118UV: "c",
            N119UV: "c",
            N749DS: "c",
            N779US: "c",
            N793US: "c",
            N4012X: "c"
        };
        const station_arm = {
            oil: 39.4,
            front_seats: 90.6,
            rear_seats: 128.0,
            wing_tanks: 103.5,
            standard_baggage_compartment: 143.7,
            standard_baggage_tube: 170.1,
            extended_baggage_forward: 153.1,
            extended_baggage_aft: 178.7
        };
        const station_max_value = {//this is the allowable value upper limits for a given station
            standard_baggage_compartment: 66,
            standard_baggage_tube: 0,//unknown and doesn't apply to any uvu aircraft
            extended_baggage_forward: 100,
            extended_baggage_aft: 40
        };
        const fuel_max_value = {
            true: 50,
            false: 40
        };
        const fuel_mass = 6.01;//lbs per gallon of fuel
        const oil_mass = 1.86; //lbs per qt of oil

        function load() {//called on load of the body
            changeAircraft("ME");//'ME' stands for manual entry, which is the default selection.
        }
        function changeAircraft(new_aircraft) {
            //reference for input elements
            let empty_weight_element = document.getElementById("empty_weight");
            let empty_cg_element = document.getElementById("empty_cg");
            let bag_weight_2_element = document.getElementById("bag_area_2");

            //reference for max value tag elements
            let max_bag_1_element = document.getElementById("max_bag_1");
            let max_bag_2_element = document.getElementById("max_bag_2");
            let max_gal_element = document.getElementById("max_gal");

            let using_preset = !(new_aircraft == "ME");//true when the user doesn't have [Manual Entry] selected
            empty_weight_element.disabled = using_preset;
            empty_cg_element.disabled = using_preset;

            //retrieve weights from the preset constant values
            empty_weight_element.value = aircraft_weight[new_aircraft];
            empty_cg_element.value = aircraft_cg[new_aircraft];

            //display bag limits
            bag_weight_2_element.disabled = false;
            if (aircraft_baggage_configuration[new_aircraft] == "c") {
                max_bag_1_element.innerHTML = "lb (max " + station_max_value["extended_baggage_forward"] + "lb)";
                max_bag_2_element.innerHTML = "lb (max " + station_max_value["extended_baggage_aft"] + "lb)";
            } else {
                max_bag_1_element.innerHTML = "lb (max " + station_max_value["standard_baggage_compartment"] + "lb)";
                if (aircraft_baggage_configuration[new_aircraft] == "b") {
                    max_bag_2_element.innerHTML = "lb (max ?)";
                } else {
                    max_bag_2_element.innerHTML = "lb";
                    bag_weight_2_element.disabled = true;
                    bag_weight_2_element.value = "";
                }
            }

            //display fuel limits
            max_gal_element.innerHTML = "gal (max " + fuel_max_value[aircraft_long_range_tank[new_aircraft]] + ")";

        }
        function getAirport() {
            //case insensitive (prefer lowercase)
            //let metarReq = "https://aviationweather.gov/api/data/metar?ids=kpvu";
            //uppercase!
            //let airportInfo = "https://aviationweather.gov/api/data/airport?ids=KPVU";
            
            //HTTP request
            //console.log(jQuery.get(metarReq));
            
            alert("not working yet");
        }
        function calculatePerformance() {

            //data collection variables
            let performance_input_page = document.getElementById("performance_input_page");
            let results_page = document.getElementById("results_page");
            let header = document.getElementById("header");

            let aircraft = document.getElementById("aircraft").value;
            let empty_weight = Number(document.getElementById("empty_weight").value);
            let empty_cg = Number(document.getElementById("empty_cg").value);

            let front_weight = Number(document.getElementById("front_weight").value);
            let front_weight_2 = Number(document.getElementById("front_weight_2").value);
            let rear_weight = Number(document.getElementById("rear_weight").value);
            let rear_weight_2 = Number(document.getElementById("rear_weight_2").value);
            
            let bag_weight = Number(document.getElementById("bag_area_1").value);
            let bag_weight_2 = Number(document.getElementById("bag_area_2").value);

            let fuel = Number(document.getElementById("fuel").value);
            let fuel_use = Number(document.getElementById("fuel_use").value);

            let field_elevation = document.getElementById("field_elevation");
            let field_temperature = document.getElementById("field_temperature");
            let altimiter_setting = document.getElementById("altimiter_setting");

            let disclaimer = document.getElementById("disclaimer");
            
            //data display variables
            //none yet

            //verify info is valid
            //mostly negative checks here:
            if (empty_weight <= 0) {
                alert("Weight is not a valid value. Must be positive.");
                return;
            }
            if (empty_cg <= 0) {
                alert("Arm is not a valid value. Must be positive.");
                return;
            }
            if ((front_weight < 0) || (front_weight_2 < 0)) {
                alert("Front Seats are not a valid value. Must be positive.");
                return;
            }
            if ((rear_weight < 0) || (rear_weight_2 < 0)) {
                alert("Rear Seats are not a valid value. Must be positive.");
                return;
            }
            if ((bag_weight < 0) || (bag_weight_2 < 0)) {
                alert("Baggage is not a valid value. Must be positive.");
                return;
            }
            if (altimiter_setting.value <= 0) {
                alert("Altimiter setting is not a valid value. Must be positive.");
                return;
            }
            if (!disclaimer.checked) {
                alert("Please check the disclaimer box to continue.");
                return;
            }
            //check bag and fuel max
            let max_bag_weight_1 = 0;
            let max_bag_weight_2 = 0;
            if (aircraft_baggage_configuration[aircraft] == "c") {
                max_bag_weight_1 = station_max_value["extended_baggage_forward"];
                max_bag_weight_2 = station_max_value["extended_baggage_aft"];
            } else {
                max_bag_weight_1 = station_max_value["standard_baggage_compartment"];
                max_bag_weight_2 = station_max_value["standard_baggage_tube"];
            }
            if ((bag_weight > max_bag_weight_1) || (bag_weight_2 > max_bag_weight_2)) {
                alert("Baggage exceeds maximum station weight.");
                return;
            }
            if (fuel > fuel_max_value[aircraft_long_range_tank[aircraft]]) {
                alert("Fuel quantity exceeds limits.");
                return;
            }
            if (fuel_use > fuel) {
                alert("Fuel use is greater than fuel available.");
                return;
            }

            //compute performance
            let total_empty_weight = empty_weight + front_weight + front_weight_2 + rear_weight + rear_weight_2 + bag_weight + bag_weight_2 + (fuel*fuel_mass) - (2*oil_mass);


            //display results
            //header
            var date = new Date();
            header.innerHTML = "<button onclick='back()'>←Go Back</button>&nbsp;Generated " + (date.getMonth()+1) + "/" + date.getDate() + "/" + date.getFullYear() + " " + date.getUTCHours() + ":" + date.getUTCMinutes() + "Z [You may screenshot this page]";
            
            performance_input_page.style.display = "none";
            results_page.style.display = "block";
            

        }
        function back() {
            performance_input_page.style.display = "block";
            results_page.style.display = "none";
        }
        
    </script>
  </head>

<body onload="load();">
    <div id="performance_input_page" style="display:block;max-width:600px;margin:auto;">
        <div style="display: flex;justify-content: center;">
            <img src="images/logo.png" alt="PPC Logo" style="max-width: 200px;">
        </div>
        <p>This tool is used for calculating weight&balance and performance for the DA40. Primarily for use with UVU aircraft. Calculations may not perfectly represent the values derived through use of an approved AFM. For simplicity, oil is assumed to be 6qts.</p>
        <h3>Enter performance parameters (DA40)</h3>

        <h4>-Select Aircraft-</h4>
        <table>
            <tr>
                <td><label for="aircraft">Identifier:</label></td>
                <td>
                    <select id="aircraft" onchange="changeAircraft(this.value);">
                        <option value="ME">[Manual Entry]</option>
                        <option value="N103UV">N103UV</option>
                        <option value="N104UV">N104UV</option>
                        <option value="N105UV">N105UV</option>
                        <option value="N106UV">N106UV</option>
                        <option value="N107UV">N107UV</option>
                        <option value="N108UV">N108UV</option>
                        <option value="N109UV">N109UV</option>
                        <option value="N110UV">N110UV</option>
                        <option value="N112UV">N112UV</option>
                        <option value="N113UV">N113UV</option>
                        <option value="N114UV">N114UV</option>
                        <option value="N115UV">N115UV</option>
                        <option value="N116UV">N116UV</option>
                        <option value="N118UV">N118UV</option>
                        <option value="N119UV">N119UV</option>
                        <option value="N749DS">N749DS</option>
                        <option value="N779US">N779US</option>
                        <option value="N793US">N793US</option>
                        <option value="N4012X">N4012X</option>
                    </select>
                </td>
                <td></td>
            </tr>
            <tr>
                <td><label for="empty_weight">Empty Weight:</label></td>
                <td><input type="number" id="empty_weight"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td><label for="empty_cg">Empty Arm:</label></td>
                <td><input type="number" id="empty_cg"></td>
                <td>in</td>
            </tr>
        </table><br>

        <h4>-Aircraft Loading-</h4>
        <table>
            <tr>
                <td><label for="front_weight">Front Seats:</label></td>
                <td><input type="number" id="front_weight" name="front_weight"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td></td>
                <td><input type="number" id="front_weight_2" name="front_weight_2"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td><label for="rear_weight">Rear Seats:</label></td>
                <td><input type="number" id="rear_weight" name="rear_weight"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td></td>
                <td><input type="number" id="rear_weight_2" name="rear_weight_2"></td>
                <td>lb</td>
            </tr>
            <tr>
                <td><label for="bag_area_1">Forward Baggage:</label></td>
                <td><input type="number" id="bag_area_1" name="bag_area_1"></td>
                <td id="max_bag_1">lb</td>
            </tr>
            <tr>
                <td><label for="bag_area_2">Aft Baggage:</label></td>
                <td><input type="number" id="bag_area_2" name="bag_area_2"></td>
                <td id="max_bag_2">lb</td>
            </tr>
            <tr>
                <td><label for="fuel">Starting Fuel:</label></td>
                <td><input type="number" id="fuel" name="fuel"></td>
                <td id="max_gal">gal</td>
            </tr>
            <tr>
                <td><label for="fuel_use">Fuel Use:</label></td>
                <td><input type="number" id="fuel_use" name="fuel_use"></td>
                <td>gal</td>
            </tr>
        </table><br>

        <h4>-Airport Conditions-</h4>
        <table>
            <tr>
                <td><label for="airport">Airport Identifier:</label></td>
                <td><input type="text" id="airport" name="airport" value="kpvu (this isn't working yet)" disabled="true"></td>
                <td><button onclick="getAirport()" disabled="true">Auto collect weather</button></td>

            </tr>
            <tr>
                <td><label for="field_elevation">Field Elevation:</label></td>
                <td><input type="number" id="field_elevation" name="field_elevation" value="4500"></td>
                <td>ft</td>
            </tr>
            <tr>
                <td><label for="field_temperature">Temperature:</label></td>
                <td><input type="number" id="field_temperature" name="field_temperature" value="15"></td>
                <td>°c</td>
            </tr>
            <tr>
                <td><label for="altimiter_setting">Altimiter Setting:</label></td>
                <td><input type="number" id="altimiter_setting" name="altimiter_setting" value="29.92"></td>
                <td>in Hg</td>
            </tr>
        </table><br>
        <label for="disclaimer">Disclaimer: By checking this box, you understand that this tool does not replace the pilot's responsibility to verify performance charactaristics with the aircraft's approved AFM.</label><br>
        <input id="disclaimer" type="checkbox"><br><br>
        <button onclick="calculatePerformance()">Calculate Performance</button>
    </div>
    <div id="results_page" style="display:block;">
        <div id="header"></div>
    </div>
</body>
</html>
